name: Deploy Parfet-Backend-Consumer Application [Development]

on:
  push:
    branches: [ develop ]

jobs:

  Deploy:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v1

      - name: SSH Remote Commands
        uses: appleboy/ssh-action@v0.1.4
        with:
          host: ${{secrets.SSH_HOST}}
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{secrets.SSH_PEM_KEY}}
          script: |
           rm -rf PAR-Backend-Consumer || :
           git clone https://${{secrets.GIT_USERNAME}}:${{secrets.GIT_PASSWORD}}@github.com/Parfet/PAR-Backend-Consumer.git
           cd PAR-Backend-Consumer
           touch .env
           echo ${{ secrets.DEV_API_ENV }} >> .env
           docker-compose down --rmi local || :
           docker-compose up -d --build
           docker ps -a